use test;

SELECT * FROM EMP;

SELECT * FROM EMP_SAL;

SELECT EID, NAME, CITY FROM EMP;

SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER';

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN (1004,1007,1008,1010,1013,1028,1067,1040,1074,1088, 1123);

SELECT EID, NAME, CITY FROM EMP -- MAIN \OUTER
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER'); -- SUB INNER 32

SELECT EID, DEPT , DESI, SALARY FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI');

SELECT EMP.EID, NAME, DEPT , DESI 
FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID= EMP_SAL.EID
WHERE DEPT = 'MIS';

SELECT * FROM TRAINING;

-- INSERT SUB QUERY

INSERT INTO TRAINING (EID, NAME, DEPT)
SELECT EMP.EID, NAME, DEPT 
FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID= EMP_SAL.EID
WHERE DEPT = 'MIS';

UPDATE TRAINING SET MODULE = 'SQL';

-- DELETE SUB QUERY
DELETE FROM TRAINING 
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI LIKE 'MANAGER%');

SELECT * FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DEHRADUN');

--UPDATE SUB QUERY
UPDATE EMP_SAL SET SALARY = SALARY + 5000
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DEHRADUN');

SELECT EID, NAME, CITY FROM EMP 
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER'); 

SELECT EID, NAME, CITY FROM EMP 
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 300000 )
ORDER BY EID DESC;


SELECT EID, NAME, CITY FROM EMP 
WHERE EID in (SELECT EID FROM EMP_SAL WHERE SALARY > 500000 );

SELECT EID, NAME, CITY FROM EMP 
WHERE EID in (SELECT EID FROM EMP_SAL WHERE SALARY BETWEEN 200000 AND 300000 );


SELECT COUNT(EID) AS 'NO OF MEMBERS', AVG(SALARY) AS 'AVG SAL' FROM EMP_SAL;

SELECT COUNT(EID) AS 'NO OF DELHI MEMBERS', AVG(SALARY) AS 'DEL AVG SAL' FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI');

SELECT COUNT(EID) AS 'NO OF DELHI MEMBERS', AVG(SALARY) AS 'DEL AVG SAL' FROM EMP_SAL  --A
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI' AND  -- B
				EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 300000)); --C

-- A => B => C  A=>C


SELECT * FROM EMP_SAL WHERE DEPT = 'HR'
AND EXISTS (SELECT * FROM EMP_SAL WHERE DEPT = 'HR' AND SALARY > 200000);

CREATE PROCEDURE L36DEMP
AS
BEGIN
	SELECT * FROM EMP
	WHERE CITY = 'DELHI';
END;

DROP PROCEDURE L36DEMP;

CREATE PROCEDURE L36DEMP @C AS VARCHAR(30)
AS
BEGIN
	SELECT * FROM EMP
	WHERE CITY = @C;
END;



EXECUTE L36DEMP;
EXEC L36DEMP;

L36DEMP;

L36DEMP 'DELHI';


CREATE PROCEDURE L36SHOW @T AS VARCHAR(20)
AS
BEGIN
	EXEC('SELECT * FROM ' +  @T);
END;

L36SHOW 'EMP';

INSERT INTO EMP
VALUES(1220, 'DEEPSHIKHA MALHIOTRA', 'DREAMS APARTMENTS', 'SECTOR 21 DWARKA', 'DELHI', '9088888890', 'DM@GMAIL.COM', '12-MAR-1996', '18-JAN-2021');

DELETE FROM EMP WHERE EID = 1220;
DELETE FROM EMP_SAL WHERE EID = 1220;

SELECT * FROM EMP_SAL;

DROP PROCEDURE L36INEMP;

CREATE PROCEDURE L36INEMP @I AS INT, @N AS VARCHAR(30), @A1 AS VARCHAR(30), @A2 AS VARCHAR(30), @C AS VARCHAR(30), @PH AS CHAR(15), @EM AS VARCHAR(50), @DB AS DATE, @DJ AS DATE
AS
BEGIN
	INSERT INTO EMP
	VALUES(@I, @N,@A1, @A2, @C, @PH, @em, @db, @DJ);

	SELECT * FROM EMP
	WHERE EID = @I;
END;

CREATE PROCEDURE L36INEMP @I AS INT, @N AS VARCHAR(30), @A1 AS VARCHAR(30), @A2 AS VARCHAR(30), @C AS VARCHAR(30), @PH AS CHAR(15), @EM AS VARCHAR(50), @DB AS DATE, @DJ AS DATE, @DPT AS VARCHAR(20), @DSI AS VARCHAR(30), @S AS INT
AS
BEGIN
	SET NOCOUNT ON;
	INSERT INTO EMP
	VALUES(@I, @N,@A1, @A2, @C, @PH, @em, @db, @DJ);

	INSERT INTO EMP_SAL
	VALUES  (@I, @DPT, @DSI, @S);

	SELECT * FROM EMP WHERE EID = @I;

	SELECT * FROM EMP_SAL WHERE EID = @I;

	SELECT EMP.EID, NAME, CITY, DOJ, DEPT, DESI, SALARY AS 'BASIC', SALARY * .15 AS 'HRA', SALARY *.09 AS 'PF'
	FROM EMP
	INNER JOIN EMP_SAL
	ON EMP.EID = EMP_SAL.EID
	WHERE EMP.EID = @I;
END;




SELECT * FROM EMP_SAL;

L36INEMP 1220, 'DEEPSHIKHA MALHIOTRA', 'DREAMS APARTMENTS', 'SECTOR 21 DWARKA', 'DELHI', '9088888890', 'DM@GMAIL.COM', '12-MAR-1996', '18-JAN-2021';

L36INEMP 1220, 'DEEPSHIKHA MALHIOTRA', 'DREAMS APARTMENTS', 'SECTOR 21 DWARKA', 'DELHI', '9088888890', 'DM@GMAIL.COM', '12-MAR-1996', '18-JAN-2021', 'TEMP', 'SR.MANAGER', 150000;

USE LEARN36;

CREATE TABLE TEMP
(ID INT,
NAME VARCHAR(10));

INSERT INTO TEMP VALUES (1,'A');
INSERT INTO TEMP VALUES (2,'B');
INSERT INTO TEMP VALUES (3,'C');
INSERT INTO TEMP VALUES (4,'D');
INSERT INTO TEMP VALUES (5,'E');
INSERT INTO TEMP VALUES (6,'F');
INSERT INTO TEMP VALUES (7,'G');
INSERT INTO TEMP VALUES (8,'H');
INSERT INTO TEMP VALUES (9,'I');
INSERT INTO TEMP VALUES (10,'J');

SELECT * FROM TEMP;

DELETE FROM TEMP WHERE ID = 10;

BEGIN TRANSACTION ;

DELETE FROM TEMP WHERE ID = 9;

ROLLBACK;

BEGIN TRANSACTION ;

DELETE FROM TEMP WHERE ID = 9;
DELETE FROM TEMP WHERE ID = 8;
DELETE FROM TEMP WHERE ID = 7;
DELETE FROM TEMP WHERE ID = 6;
DELETE FROM TEMP WHERE ID = 5;

ROLLBACK;

SELECT * FROM TEMP;

BEGIN TRANSACTION ;

DELETE FROM TEMP WHERE ID = 4;
DELETE FROM TEMP WHERE ID = 5;

SAVE TRANSACTION T1; --SAVE POINT
DELETE FROM TEMP WHERE ID = 6;

SAVE TRANSACTION T2;
DELETE FROM TEMP WHERE ID = 7;
DELETE FROM TEMP WHERE ID = 8;

SAVE TRANSACTION T3;
DELETE FROM TEMP WHERE ID = 9;

SELECT * FROM TEMP;

ROLLBACK TRANSACTION T2;

BEGIN TRANSACTION ;

DELETE FROM TEMP WHERE ID = 9;
DELETE FROM TEMP WHERE ID = 8;
COMMIT;